# 🤖 NCP CLOVA 연동 챗봇 서비스

> **네이버 클라우드 플랫폼(NCP)의 CLOVA Chatbot API**를 활용하여 사용자와 실시간 대화가 가능한 웹 기반 채팅 서비스를 구현한 프로젝트입니다.

> 우리 FISA 6기 학생들의 어려움을 해결할 수 있도록 각 질문에 대한 답변을 제공합니다.

---
## 0. 팀원

| 팀원1 | 팀원2 | 팀원3 | 팀원4 |
| :--- | :--- | :--- | :--- |
| **이건희** | **송민혁** | **박주호** | **이유림** |
| 프론트 API 연동 | 클로바 모델 학습 </br>클로바 API 연동 | 이벤트 핸들링</br>CSS | CSS |

---
## 1. 프로젝트 개요

클로바 챗봇을 제작하고 API를 연동하며 겪는 시행착오, 문제의 해결방법을 문의할 수 있는 챗봇 서비스

---

## 2. 챗봇 모델

* 7개 대화 주제에 따른 답변을 하도록 구현
* 각 Step 별로 가이드 답변을 제공
![alt text](image.png)

---

## 3. 프로젝트 주요 구현내용

* **초기 메시지 로드**: 페이지 접속 시 `/start` 엔드포인트를 호출하여 클로바 챗봇의 웰컴 메시지를 자동으로 불러옵니다.
  
* **챗봇 질의 응답**: 사용자의 입력을 `/ask` 엔드포인트를 통해 챗봇에 전달하고 실시간 답변을 처리합니다.
  
* **사용자 편의 UI/UX**:
    * **자동 스크롤**: 새 메시지 생성 시 채팅창 하단으로 즉시 포커싱되고, 메시지 박스의 총 크기가 화면보다 길어지면 스크롤 바를 통해 올리고 내릴 수 있으며, 스크롤바는 보이지 않도록 구현했습니다.
    * **시간 표기**: `now()` 함수를 통해 현재 시각을 timestamp 값에 넣어 요청하여 메시지 전송 시각을 화면에 출력합니다.
    * **엔터 입력 지원 및 오류 방지**: 전송 버튼 클릭 시 sendMessage 호출 외에도 엔터 입력 시 호출하여 엔터 입력을 지원합니다. 또한, `isComposing` 상태 체크를 통해 한글 입력 시 마지막 글자의 중복 입력을 방지하고, `preventDefault`를 통해 엔터키 줄바꿈을 방지했습니다.

---

## 4. 프로젝트 트러블슈팅

* **클로바 API 연동**
    클로바의 `open`, `send` API를 활용할 때 응답이 아래처럼 오는 문제 발생
    
    </br>

    ```
    {
    "success": false,
    "resultCode": "99",
    "resultMessage": "Message contents is empty"
    }
    ```
    원인은 API의 version이 달랐던 문제.
    v1 버전에서는 content 태그 안에 details : text 형태였지만
    v2 버전에서는 bubbles 태그 안에 description : text 형태였다.

</br>

* **payload 제작**
    클로바의 `send` API 사용 시 http code는 200번이지만, 응답으로는 빈 Json이 오는 문제 발생

    <br>

    원인은 payload의 body 중 details 값이 `"[object HTMLDivElement]"`로 들어가서 올바른 답변이 나오지 않았던 것.

    \<div> 태그에서 값을 추출하기 위해 .textContent를 추가해서 올바른 payload로 요청하니 해결되었다.

